<html>
<!--Page generated by REBOL-->
<head>
<title>Timer.r and Threads.r</title>
<style type="text/css">
html, body, p, td, li {font-family: arial, sans-serif, helvetica; font-size: 10pt;}
h1 {font-size: 16pt; Font-Weight: bold;}
h2 {font-size: 14pt; color: #2030a0; Font-Weight: bold; width: 100%;
    border-bottom: 1px solid #c09060;}
h3 {font-size: 12pt; color: #2030a0; Font-Weight: bold;}
h4 {font-size: 10pt; color: #2030a0; Font-Weight: bold;}
h5 {font-size: 10pt; Font-Weight: bold;}
tt {font-family: "courier new", monospace, courier; color: darkgreen;}
pre {font: bold 10pt "courier new", monospace, console;
    background-color: #e0e0e0; padding: 16px; border: solid #a0a0a0 1px;}
.toc1 {margin-left: 1cm; font-size: 12pt; font-weight: bold;}
.toc2 {margin-left: 2cm; font-size: 10pt; Font-Weight: bold; text-decoration: none;}
.toc3 {margin-left: 3cm; font-size: 10pt; text-decoration: none;}
.toc4 {margin-left: 4cm; font-size: 10pt; color: grey; text-decoration: none;}
.output {color: #000080; font-weight: normal;}
.note {background-color: #f0e090; width: 100%; padding: 16px; border: solid #a0a0a0 1px;}
.tail {color: gray; font-size: 8pt;}
</style>
</head>
<body bgcolor="white">
<table width="660" cellpadding="4" cellspacing="0" border="0">
<tr>
<td><a href="http://www.rebol.com"><img src="http://www.rebol.net/graphics/reb-bare.jpg"
    border=0 alt="REBOL"></a></td>
</tr>
<tr height="10"><td></td></tr>
<tr><td><h1>Timer.r and Threads.r</h1>
<blockquote><b>
Date: 14-Feb-2006/14:21:48+1:00<br>Author: Ladislav Mecir
</b></blockquote>
<h2>Contents:</h2>
<a class="toc1" href="#section-1">1. Purpose</a><br>
<a class="toc1" href="#section-2">2. Timer.r</a><br>
<a class="toc2" href="#section-2.1">2.1 Implementation</a><br>
<a class="toc2" href="#section-2.2">2.2 Add-alarm</a><br>
<a class="toc1" href="#section-3">3. Threads.r</a><br>
<a class="toc2" href="#section-3.1">3.1 Implementation</a><br>
<a class="toc2" href="#section-3.2">3.2 Add-thread</a><br>
<h2 id="section-1">1. Purpose</h2>
<blockquote>
<p>The files are written to support basic threading in Rebol.</p>
</blockquote>
<h2 id="section-2">2. Timer.r</h2>
<blockquote>
<p>This file defines the base functions for %threads.r:</p>
<pre>
add-alarm
do-events
</pre>
</blockquote>
<h3 id="section-2.1">2.1 Implementation</h3>
<blockquote>
<p>Timer.r is implemented using REBOL lists, which makes both the above mentioned functions faster than a similar implementation using REBOL blocks would be. Moreover, the implementation maintains the alarms sorted, which eliminates the need to use SORT and therefore adds speed too.</p>
</blockquote>
<h3 id="section-2.2">2.2 Add-alarm</h3>
<blockquote>
<p>Add-alarm is a function taking two arguments: Time and Alarm.</p>
<p>The Time argument specifies when the Alarm should happen. If it is a Time! or a Number!, it is supposed to specify the length of the time interval to wait (in seconds if it is a Number!).</p>
<p>The Alarm argument can be either a function, or a word. If it is a word, the caller can easily kill the alarm by simply setting the supplied word to None.</p>
<p>Add-alarm doesn't create repetitive alarms, although it is easy to create them using Add-alarm e.g. as follows:</p>
<pre>
handle-timer: does [
    print ["alarm" now/precise]
    add-alarm 0:0:5 'handle-timer
]
</pre>
<p>To kill the alarm, it is sufficient to set the 'handle-timer variable to None. Here is a more complicated repetitive alarm going off after a specified time:</p>
<pre>
stop-time: load ask "stop time:"
alarm-time: load ask "alarm time:"
handle-timer: does [
    print ["alarm" now/precise]
    either stop-time &gt;= difference now/precise start-time [
        add-alarm alarm-time 'handle-timer
    ] [print "done"]
]
start-time: now/precise
handle-timer
do-events
</pre>
<p>An example result of such code:</p>
<pre>
stop time:0:0:40
alarm time:0:0:5
alarm 14-Feb-2006/14:54:18.569+1:00
alarm 14-Feb-2006/14:54:23.569+1:00
alarm 14-Feb-2006/14:54:28.569+1:00
alarm 14-Feb-2006/14:54:33.569+1:00
alarm 14-Feb-2006/14:54:38.569+1:00
alarm 14-Feb-2006/14:54:43.569+1:00
alarm 14-Feb-2006/14:54:48.569+1:00
alarm 14-Feb-2006/14:54:53.569+1:00
alarm 14-Feb-2006/14:54:58.569+1:00
alarm 14-Feb-2006/14:55:03.569+1:00
done
</pre>
</blockquote>
<h2 id="section-3">3. Threads.r</h2>
<blockquote>
<p>This file uses %timer.r to define more complicated functions than %timer.r:</p>
<pre>
Add-thread - a more complicated counterpart of Add-alarm
Check-next-trigger - for backward compatibility with older implementation
Kill-thread - Add-thread opposite
Thread-exists? - to check for thread existence
Cid? - find out the Callback-id of a thread knowing its Thread-id
Thread-id? - find out the Thread-id of a thread knowing its Callback-id
Length-threads? - returns how many threads exist
Thread-type? - given the Thread-id returns the type of the thread
</pre>
</blockquote>
<h3 id="section-3.1">3.1 Implementation</h3>
<blockquote>
<p>As opposed to %timer.r and due to the BEER RPC profile compatibility requirements %threads.r use a string as both a thread identifier and a callback identifier.</p>
<p>This leads to a relative slow down compared to the %timer.r implementation, because the comparison of strings is slower than comparison of words in REBOL. 
Moreover, because the identifiers are strings, the implementation needs to check for uniqueness, which is unnecessary for REBOL words. Therefore the Add-thread implementation has to use the Find function, which is another slow-down compared to %timer.r The similar slow down is observable for Kill-thread, which doesn't even exist for %timer.r, because it is rather trivial in that case.</p>
</blockquote>
<h3 id="section-3.2">3.2 Add-thread</h3>
<blockquote>
<p>As opposed to Add-alarm the Add-thread allows the usage of /repeat refinement allowing to define repetitive threads.</p>
<p>The End</p>
</blockquote>
</td></tr><tr>
<tr><td><img src="http://www.rebol.net/graphics/reb-tail.jpg" border=0></td></tr>
<td align="center">
<span class="tail"><a href="http://www.rebol.com">MakeDoc2 by REBOL</a> - 20-Feb-2006</span>
</td></tr></table>
</body></html>
